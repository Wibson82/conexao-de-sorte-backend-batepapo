# ============================================================================
# üß™ CONFIGURA√á√ÉO DE TESTES COM TESTCONTAINERS - JAVA 24
# ============================================================================
#
# Configura√ß√£o espec√≠fica para testes com Testcontainers:
# - MySQL container real
# - Redis container (se necess√°rio)
# - Configura√ß√µes otimizadas para containers
# - Sem Mockito
#
# @author Sistema de Testes Java 24
# @version 1.0
# @since 2024
# ============================================================================

# ========================================
# üè∑Ô∏è CONFIGURA√á√ïES GERAIS
# ========================================
spring:
  application:
    name: batepapo-microservice-testcontainers
  main:
    banner-mode: off
    
  # ========================================
  # üóÑÔ∏è BANCO DE DADOS (TESTCONTAINERS MySQL)
  # ========================================
  # As configura√ß√µes de R2DBC ser√£o definidas dinamicamente pelo teste
  # usando @DynamicPropertySource com Testcontainers
  
  # Flyway desabilitado para Testcontainers (schema criado via SQL)
  flyway:
    enabled: false
    
  # ========================================
  # üîê SEGURAN√áA JWT (DESABILITADA)
  # ========================================
  security:
    oauth2:
      resourceserver:
        jwt:
          # JWT desabilitado para testes de integra√ß√£o
          jwk-set-uri: http://localhost:9999/.well-known/jwks.json

  # ========================================
  # üöÄ REDIS (MOCK/EMBARCADO)
  # ========================================
  data:
    redis:
      # Configura√ß√µes ser√£o sobrescritas se necess√°rio
      host: localhost
      port: 6379
      timeout: 1s

# ========================================
# üåê SERVIDOR (PORTA ALEAT√ìRIA)
# ========================================
server:
  port: 0

# ========================================
# üö¶ FEATURE FLAGS (TESTES)
# ========================================
feature:
  batepapo-ms: true
  websocket: false
  sse: false
  message-persistence: true
  redis-streams: false
  rate-limiting: false

# ========================================
# üí¨ CONFIGURA√á√ïES DE CHAT (TESTE)
# ========================================
chat:
  max-message-length: 500
  max-rooms-per-user: 10
  message-retention-days: 1
  online-timeout-minutes: 1
  heartbeat-interval-seconds: 5
  max-connections-per-user: 5

# ========================================
# üìù LOGGING (OTIMIZADO PARA TESTCONTAINERS)
# ========================================
logging:
  level:
    root: WARN
    br.tec.facilitaservicos.batepapo: INFO
    # Testcontainers logs
    org.testcontainers: INFO
    com.github.dockerjava: WARN
    # R2DBC logs para debug
    org.springframework.r2dbc: DEBUG
    # Outros logs minimizados
    org.springframework.security: ERROR
    org.springframework.web: WARN
    reactor.netty: WARN
  pattern:
    console: "%clr(%d{HH:mm:ss.SSS}){faint} %clr(%-5level) %clr([%thread]){faint} %clr(%logger{36}){cyan} - %msg%n"

# ========================================
# üìä ACTUATOR (SIMPLIFICADO)
# ========================================
management:
  endpoints:
    web:
      exposure:
        include: health,info
  endpoint:
    health:
      show-details: always

# ========================================
# üß™ CONFIGURA√á√ïES ESPEC√çFICAS DE TESTE
# ========================================
test:
  containers:
    mysql:
      image: "mysql:8.0"
      database: "batepapo_test"
      username: "testuser"
      password: "testpass"
    
  timeouts:
    container-startup: 60s
    database-ready: 30s
    web-request: 5s