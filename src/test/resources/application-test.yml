# ============================================================================
# ğŸ§ª CONFIGURAÃ‡ÃƒO DE TESTES - MICROSERVIÃ‡O BATE-PAPO
# ============================================================================
#
# ConfiguraÃ§Ã£o otimizada para execuÃ§Ã£o de testes:
# - Banco H2 em memÃ³ria
# - JWT mockeado
# - Redis embarcado
# - WebSocket desabilitado
# - SSE simplificado
# - Logs minimizados
#
# @author Sistema de MigraÃ§Ã£o R2DBC
# @version 1.0
# @since 2024
# ============================================================================

# ========================================
# ğŸ·ï¸ CONFIGURAÃ‡Ã•ES GERAIS
# ========================================
spring:
  application:
    name: batepapo-microservice-test
  main:
    banner-mode: off
    
  # ========================================
  # ğŸ—„ï¸ BANCO DE DADOS (H2 EM MEMÃ“RIA)
  # ========================================
  r2dbc:
    url: r2dbc:h2:mem:///testdb?options=DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE
    username: sa
    password: ""
    
  # Flyway desabilitado para testes (schema criado via @Sql)
  flyway:
    enabled: false
    
  # InicializaÃ§Ã£o SQL desabilitada para testes
  sql:
    init:
      mode: never

  # ========================================
  # ğŸ” SEGURANÃ‡A JWT (MOCK)
  # ========================================
  security:
    oauth2:
      resourceserver:
        jwt:
          # JWT desabilitado para testes - usar @WithMockUser
          enabled: false

  # ========================================
  # ğŸš€ REDIS (MOCK/EMBARCADO)
  # ========================================
  data:
    redis:
      # Redis embarcado para testes
      host: localhost
      port: 6371
      timeout: 500ms

# ========================================
# ğŸŒ SERVIDOR (PORTA ALEATÃ“RIA)
# ========================================
server:
  port: 0

# ========================================
# ğŸš¦ FEATURE FLAGS (TESTES)
# ========================================
feature:
  batepapo-ms: true
  websocket: false  # WebSocket desabilitado para testes
  sse: true
  message-persistence: true
  redis-streams: false  # Redis streams desabilitado para testes
  rate-limiting: false  # Rate limiting desabilitado para testes

# ========================================
# ğŸ’¬ CONFIGURAÃ‡Ã•ES DE CHAT (TESTE)
# ========================================
chat:
  max-message-length: 500
  max-rooms-per-user: 10
  message-retention-days: 1  # RetenÃ§Ã£o mÃ­nima para testes
  online-timeout-minutes: 1  # Timeout reduzido para testes
  heartbeat-interval-seconds: 5  # Heartbeat mais frequente
  max-connections-per-user: 5

# ========================================
# ğŸ“ LOGGING (MINIMIZADO)
# ========================================
logging:
  level:
    root: WARN
    br.tec.facilitaservicos.batepapo: DEBUG
    org.springframework.security: ERROR
    org.springframework.web: ERROR
    org.springframework.r2dbc: ERROR
    reactor.netty: ERROR
    io.r2dbc: ERROR
  pattern:
    console: "%clr(%d{HH:mm:ss.SSS}){faint} %clr(%-5level) %clr([%thread]){faint} %clr(%logger{36}){cyan} - %msg%n"

# ========================================
# ğŸ“Š ACTUATOR (SIMPLIFICADO)
# ========================================
management:
  endpoints:
    web:
      exposure:
        include: health,info
  endpoint:
    health:
      show-details: always

# ========================================
# ğŸ›¡ï¸ RESILIENCE4J (DESABILITADO)
# ========================================
resilience4j:
  circuitbreaker:
    instances:
      database:
        enabled: false
      redis:
        enabled: false
        
  ratelimiter:
    instances:
      chat-service:
        enabled: false

# ========================================
# ğŸŒ CORS (PERMISSIVO PARA TESTES)
# ========================================
cors:
  allowed-origins: "*"
  allowed-methods: "*"
  allowed-headers: "*"
  allow-credentials: false

# ========================================
# ğŸŒ CONFIGURAÃ‡Ã•ES DE SERVIÃ‡OS EXTERNOS (MOCK)
# ========================================
services:
  auth:
    url: http://localhost:8081
    endpoints:
      validate: /auth/validate
      users: /rest/v1/users
    timeout: 1s
    
# ========================================
# ğŸ§ª CONFIGURAÃ‡Ã•ES ESPECÃFICAS DE TESTE
# ========================================
test:
  # ConfiguraÃ§Ãµes especÃ­ficas para testes
  mock-services:
    redis: true
    websocket: true
    sse: true
    auth: true  # Mock do serviÃ§o de autenticaÃ§Ã£o
  
  # Dados de teste
  usuarios-teste:
    - user123
    - user456
    - moderator123
  
  salas-teste:
    - geral
    - tecnologia
    - jogos
  
  # Timeouts reduzidos
  timeouts:
    web: 1s
    database: 500ms
    redis: 200ms
    sse: 30s